<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cpp-template doxyfied: Packaging for Bazel</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">cpp-template doxyfied
   </div>
   <div id="projectbrief">Docuumented version of cpp-template</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Packaging for Bazel </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Deprecated</h1>
<p>These rules have been extracted from the Bazel sources and are now available at <a href="https://github.com/bazelbuild/rules_pkg/releases">bazelbuild/rules_pkg</a>.</p>
<p>Issues and PRs against the built-in versions of these rules will no longer be addressed. This page will exist for reference until the code is removed from Bazel. You can test the removal of these rules with Bazel at version &gt;= 0.28.0.</p>
<div class="fragment"><div class="line">bazel build --//tools/build_defs/pkg:incompatible_no_build_defs_pkg  target...</div>
</div><!-- fragment --><p>For more information, follow <a href="https://github.com/bazelbuild/bazel/issues/8857">issue 8857</a></p>
<h1>rules_pkg</h1>
<div class="toc"> <h2>Rules</h2>
</div><div class="toc"> <ul>
<li>
<a href="#pkg_tar">pkg_tar</a> </li>
<li>
<a href="#pkg_deb">pkg_deb</a> </li>
<li>
<a href="#pkg_rpm">pkg_rpm</a> </li>
</ul>
</div><h1>Overview</h1>
<p>These build rules are used for building various packaging such as tarball and debian package.</p>
<p><a class="anchor" id="basic-example"></a> </p><h1>Basic Example</h1>
<p>This example is a simplification of the debian packaging of Bazel:</p>
<div class="fragment"><div class="line">load(&quot;@bazel_tools//tools/build_defs/pkg:pkg.bzl&quot;, &quot;pkg_tar&quot;, &quot;pkg_deb&quot;)</div>
<div class="line"> </div>
<div class="line">pkg_tar(</div>
<div class="line">    name = &quot;bazel-bin&quot;,</div>
<div class="line">    strip_prefix = &quot;/src&quot;,</div>
<div class="line">    package_dir = &quot;/usr/bin&quot;,</div>
<div class="line">    srcs = [&quot;//src:bazel&quot;],</div>
<div class="line">    mode = &quot;0755&quot;,</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">pkg_tar(</div>
<div class="line">    name = &quot;bazel-tools&quot;,</div>
<div class="line">    strip_prefix = &quot;/&quot;,</div>
<div class="line">    package_dir = &quot;/usr/share/lib/bazel/tools&quot;,</div>
<div class="line">    srcs = [&quot;//tools:package-srcs&quot;],</div>
<div class="line">    mode = &quot;0644&quot;,</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">pkg_tar(</div>
<div class="line">    name = &quot;debian-data&quot;,</div>
<div class="line">    extension = &quot;tar.gz&quot;,</div>
<div class="line">    deps = [</div>
<div class="line">        &quot;:bazel-bin&quot;,</div>
<div class="line">        &quot;:bazel-tools&quot;,</div>
<div class="line">    ],</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">pkg_deb(</div>
<div class="line">    name = &quot;bazel-debian&quot;,</div>
<div class="line">    architecture = &quot;amd64&quot;,</div>
<div class="line">    built_using = &quot;unzip (6.0.1)&quot;,</div>
<div class="line">    data = &quot;:debian-data&quot;,</div>
<div class="line">    depends = [</div>
<div class="line">        &quot;zlib1g-dev&quot;,</div>
<div class="line">        &quot;unzip&quot;,</div>
<div class="line">    ],</div>
<div class="line">    description_file = &quot;debian/description&quot;,</div>
<div class="line">    homepage = &quot;http://bazel.build&quot;,</div>
<div class="line">    maintainer = &quot;The Bazel Authors &lt;bazel-dev@googlegroups.com&gt;&quot;,</div>
<div class="line">    package = &quot;bazel&quot;,</div>
<div class="line">    version = &quot;0.1.1&quot;,</div>
<div class="line">)</div>
</div><!-- fragment --><p>Here, the Debian package is built from three <code>pkg_tar</code> targets:</p>
<ul>
<li><code>bazel-bin</code> creates a tarball with the main binary (mode <code>0755</code>) in <code>/usr/bin</code>,</li>
<li><code>bazel-tools</code> create a tarball with the base workspace (mode <code>0644</code>) to <code>/usr/share/bazel/tools</code> ; the <code>modes</code> attribute let us specifies executable files,</li>
<li><code>debian-data</code> creates a gzip-compressed tarball that merge the three previous tarballs.</li>
</ul>
<p><code>debian-data</code> is then used for the data content of the debian archive created by <code>pkg_deb</code>.</p>
<p><a class="anchor" id="future"></a> </p><h1>Future work</h1>
<ul>
<li>Support more format, especially <code>pkg_zip</code>.</li>
<li>Maybe a bit more integration with the <code>docker_build</code> rule.</li>
</ul>
<p><a class="anchor" id="pkg_tar"></a> </p><h1>pkg_tar</h1>
<div class="fragment"><div class="line">pkg_tar(name, extension, strip_prefix, package_dir, srcs,</div>
<div class="line">mode, modes, deps, symlinks)</div>
</div><!-- fragment --><p>Creates a tar file from a list of inputs.</p>
<table class="table table-condensed table-bordered table-params">
</table>
<p>&lt;col class="col-param"&gt; &lt;col class="param-description"&gt; &lt;/colgroup&gt; &lt;thead&gt; </p>
<p>Attributes  &lt;/thead&gt; &lt;tbody&gt; </p>
<p><code>name</code> </p>
<p><code>Name, required</code> </p>
<p>A unique name for this rule.</p>
<p><code>extension</code> </p>
<p><code>String, default to 'tar'</code> </p>
<p>The extension for the resulting tarball. The output file will be '<em>name</em>.<em>extension</em>'. This extension also decide on the compression: if set to <code>tar.gz</code> or <code>tgz</code> then gzip compression will be used and if set to <code>tar.bz2</code> or <code>tar.bzip2</code> then bzip2 compression will be used. </p>
<p><code>strip_prefix</code> </p>
<p><code>String, optional</code> </p>
<p>Root path of the files.</p>
<p>The directory structure from the files is preserved inside the tarball but a prefix path determined by <code>strip_prefix</code> is removed from the directory structure. This path can be absolute from the workspace root if starting with a <code>/</code> or relative to the rule's directory. A relative path may start with "./" (or be ".") but cannot use ".." to go up level(s). By default, the <code>strip_prefix</code> attribute is unused and all files are supposed to have no prefix. A <code>strip_prefix</code> of "" (the empty string) means the same as the default. </p>
<p><code>package_dir</code> </p>
<p><code>String, optional</code> </p>
<p>Target directory.</p>
<p>The directory in which to expand the specified files, defaulting to '/'. Only makes sense accompanying files. </p>
<p><code>srcs</code> </p>
<p><code>List of files, optional</code> </p>
<p>File to add to the layer.</p>
<p>A list of files that should be included in the archive. </p>
<p><code>mode</code> </p>
<p><code>String, default to 0555</code> </p>
<p>Set the mode of files added by the <code>files</code> attribute. </p>
<p><code>mtime</code> </p>
<p><code>int, seconds since Jan 1, 1970, default to -1 (ignored)</code> </p>
<p>Set the mod time of files added by the <code>files</code> attribute. </p>
<p><code>portable_mtime</code> </p>
<p><code>bool, default True</code> </p>
<p>Set the mod time of files added by the <code>files</code> attribute to a 2000-01-01. </p>
<p><code>modes</code> </p>
<p><code>Dictionary, default to '{}'</code> </p>
<p>A string dictionary to change default mode of specific files from <code>files</code>. Each key should be a path to a file before appending the prefix <code>package_dir</code> and the corresponding value the octal permission of to apply to the file. </p>
<p><code> modes = { "tools/py/2to3.sh": "0755", ... }, </code> </p>
<p><code>owner</code> </p>
<p><code>String, default to '0.0'</code> </p>
<p><code>UID.GID</code> to set the default numeric owner for all files provided in <code>files</code>. </p>
<p><code>owners</code> </p>
<p><code>Dictionary, default to '{}'</code> </p>
<p>A string dictionary to change default owner of specific files from <code>files</code>. Each key should be a path to a file before appending the prefix <code>package_dir</code> and the corresponding value the <code>UID.GID</code> numeric string for the owner of the file. When determining owner ids, this attribute is looked first then <code>owner</code>. </p>
<p><code> owners = { "tools/py/2to3.sh": "42.24", ... }, </code> </p>
<p><code>ownername</code> </p>
<p><code>String, optional</code> </p>
<p><code>username.groupname</code> to set the default owner for all files provided in <code>files</code> (by default there is no owner names). </p>
<p><code>ownernames</code> </p>
<p><code>Dictionary, default to '{}'</code> </p>
<p>A string dictionary to change default owner of specific files from <code>files</code>. Each key should be a path to a file before appending the prefix <code>package_dir</code> and the corresponding value the <code>username.groupname</code> string for the owner of the file. When determining ownernames, this attribute is looked first then <code>ownername</code>. </p>
<p><code> owners = { "tools/py/2to3.sh": "leeroy.jenkins", ... }, </code> </p>
<p><code>deps</code> </p>
<p><code>List of labels, optional</code> </p>
<p>Tar files to extract and include in this tar package.</p>
<p>A list of tarball labels to merge into the output tarball. </p>
<p><code>symlinks</code> </p>
<p><code>Dictionary, optional</code> </p>
<p>Symlinks to create in the output tarball.</p>
<p><code> symlinks = { "/path/to/link": "/path/to/target", ... }, </code> </p>
<p><code>remap_paths</code> </p>
<p><code>Dictionary, optional</code> </p>
<p>Source path prefixes to remap in the tarfile.</p>
<p><code> remap_paths = { "original/path/prefix": "replaced/path", ... }, </code> </p>
<p>&lt;/tbody&gt; </p>
<p><a class="anchor" id="pkg_deb"></a> </p><h2>pkg_deb</h2>
<div class="fragment"><div class="line">pkg_deb(name, data, package, architecture, maintainer, preinst, postinst, prerm, postrm, version, version_file, description, description_file, built_using, built_using_file, priority, section, homepage, depends, suggests, enhances, conflicts, predepends, recommends)</div>
</div><!-- fragment --><p>Create a debian package. See <a href="http://www.debian.org/doc/debian-policy/ch-controlfields.html">http://www.debian.org/doc/debian-policy/ch-controlfields.html</a> for more details on this.</p>
<table class="table table-condensed table-bordered table-params">
</table>
<p>&lt;col class="col-param"&gt; &lt;col class="param-description"&gt; &lt;/colgroup&gt; &lt;thead&gt; </p>
<p>Attributes  &lt;/thead&gt; &lt;tbody&gt; </p>
<p><code>name</code> </p>
<p><code>Name, required</code> </p>
<p>A unique name for this rule.</p>
<p><code>data</code> </p>
<p><code>File, required</code> </p>
<p>A tar file that contains the data for the debian package (basically the list of files that will be installed by this package). </p>
<p><code>package</code> </p>
<p><code>String, required</code> </p>
<p>The name of the package.</p>
<p><code>architecture</code> </p>
<p><code>String, default to 'all'</code> </p>
<p>The architecture that this package target.</p>
<p>See <a href="http://www.debian.org/ports/">http://www.debian.org/ports/</a>. </p>
<p><code>maintainer</code> </p>
<p><code>String, required</code> </p>
<p>The maintainer of the package.</p>
<p><code>preinst</code>, <code>postinst</code>, <code>prerm</code> and <code>postrm</code> </p>
<p><code>Files, optional</code> </p>
<p>Respectively, the pre-install, post-install, pre-remove and post-remove scripts for the package. </p>
<p>See <a href="http://www.debian.org/doc/debian-policy/ch-maintainerscripts.html">http://www.debian.org/doc/debian-policy/ch-maintainerscripts.html</a>. </p>
<p><code>config</code> </p>
<p><code>File, optional</code> </p>
<p>config file used for debconf integration. </p>
<p>See <a href="https://www.debian.org/doc/debian-policy/ch-binary.html#prompting-in-maintainer-scripts">https://www.debian.org/doc/debian-policy/ch-binary.html#prompting-in-maintainer-scripts</a>. </p>
<p><code>templates</code> </p>
<p><code>File, optional</code> </p>
<p>templates file used for debconf integration. </p>
<p>See <a href="https://www.debian.org/doc/debian-policy/ch-binary.html#prompting-in-maintainer-scripts">https://www.debian.org/doc/debian-policy/ch-binary.html#prompting-in-maintainer-scripts</a>. </p>
<p><code>conffiles</code>, <code>conffiles_file</code> </p>
<p><code>String list or File, optional</code> </p>
<p>The list of conffiles or a file containing one conffile per line. Each item is an absolute path on the target system where the deb is installed. </p>
<p>See <a href="https://www.debian.org/doc/manuals/debian-faq/ch-pkg_basics.en.html#s-conffile">https://www.debian.org/doc/manuals/debian-faq/ch-pkg_basics.en.html#s-conffile</a>. </p>
<p><code>version</code>, <code>version_file</code> </p>
<p><code>String or File, required</code> </p>
<p>The package version provided either inline (with <code>version</code>) or from a file (with <code>version_file</code>). </p>
<p><code>description</code>, <code>description_file</code> </p>
<p><code>String or File, required</code> </p>
<p>The package description provided either inline (with <code>description</code>) or from a file (with <code>description_file</code>). </p>
<p><code>built_using</code>, <code>built_using_file</code> </p>
<p><code>String or File</code> </p>
<p>The tool that were used to build this package provided either inline (with <code>built_using</code>) or from a file (with <code>built_using_file</code>). </p>
<p><code>priority</code> </p>
<p><code>String, default to 'optional'</code> </p>
<p>The priority of the package.</p>
<p>See <a href="http://www.debian.org/doc/debian-policy/ch-archive.html#s-priorities">http://www.debian.org/doc/debian-policy/ch-archive.html#s-priorities</a>. </p>
<p><code>section</code> </p>
<p><code>String, default to 'contrib/devel'</code> </p>
<p>The section of the package.</p>
<p>See <a href="http://www.debian.org/doc/debian-policy/ch-archive.html#s-subsections">http://www.debian.org/doc/debian-policy/ch-archive.html#s-subsections</a>. </p>
<p><code>homepage</code> </p>
<p><code>String, optional</code> </p>
<p>The homepage of the project.</p>
<p><code>depends</code>, <code>suggests</code>, <code>enhances</code>, <code>conflicts</code>, <code>predepends</code> and <code>recommends</code>.  </p>
<p><code>String list, optional</code> </p>
<p>The list of dependencies in the project.</p>
<p>See <a href="http://www.debian.org/doc/debian-policy/ch-relationships.html#s-binarydeps">http://www.debian.org/doc/debian-policy/ch-relationships.html#s-binarydeps</a>. </p>
<p>&lt;/tbody&gt; </p>
<p><a class="anchor" id="pkg_rpm"></a> </p><h2>pkg_rpm</h2>
<div class="fragment"><div class="line">pkg_rpm(name, spec_file, architecture, version, version_file, changelog, data)</div>
</div><!-- fragment --><p>Create an RPM package. See <a href="http://rpm.org/documentation.html">http://rpm.org/documentation.html</a> for more details on this.</p>
<table class="table table-condensed table-bordered table-params">
</table>
<p>&lt;col class="col-param"&gt; &lt;col class="param-description"&gt; &lt;/colgroup&gt; &lt;thead&gt; </p>
<p>Attributes  &lt;/thead&gt; &lt;tbody&gt; </p>
<p><code>name</code> </p>
<p><code>Name, required</code> </p>
<p>A unique name for this rule. Used to name the output package.</p>
<p><code>spec_file</code> </p>
<p><code>File, required</code> </p>
<p>The RPM specification file used to generate the package.</p>
<p>See <a href="http://ftp.rpm.org/max-rpm/s1-rpm-build-creating-spec-file.html">http://ftp.rpm.org/max-rpm/s1-rpm-build-creating-spec-file.html</a>. </p>
<p><code>architecture</code> </p>
<p><code>String, default to 'all'</code> </p>
<p>The architecture that this package target.</p>
<p><code>version</code>, <code>version_file</code> </p>
<p><code>String or File, required</code> </p>
<p>The package version provided either inline (with <code>version</code>) or from a file (with <code>version_file</code>). </p>
<p><code>data</code> </p>
<p><code>Files, required</code> </p>
<p>Files to include in the generated package. </p>
<p>&lt;/tbody&gt; </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
